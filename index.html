<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏ß‡∏∞‡∏≠‡πâ‡∏ß‡∏ô - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to right, #ff9a9e, #fecfef);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .card {
            background: #ffb6c1;
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            background: #ff69b4;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            color: #fff;
        }

        .btn-primary, .btn-success, .btn-danger {
            background: #ff69b4;
            border: none;
            border-radius: 25px;
            transition: background 0.3s ease;
        }

        .btn-primary:hover, .btn-success:hover, .btn-danger:hover {
            background: #ff1493;
        }

        .table thead {
            background: #ff69b4;
            color: #fff;
        }

        input[type="text"], input[type="password"], input[type="number"], input[type="date"] {
            border-radius: 25px;
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="container mt-5" id="login-section">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header text-center">
                        <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
                    </div>
                    <div class="card-body">
                        <form onsubmit="return login(event)">
                            <div class="mb-3">
                                <label for="user_name" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                <input type="text" class="form-control" id="user_name" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                <input type="password" class="form-control" id="password" required>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5" id="app-section" style="display:none;">
        <div class="row">
            <div class="col-10">
                <h1>üå∏ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏ß‡∏∞‡∏≠‡πâ‡∏ß‡∏ô üå∏</h1>
            </div>
            <div class="col-2 text-end">
                <button type="button" class="btn btn-danger" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header text-center">
                <h3>üê∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û üê∞</h3>
            </div>
            <div class="card-body">
                <form onsubmit="return saveHealthData(event)">
                    <div class="mb-3">
                        <label for="user_id" class="form-label">üÜî ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ </label>
                        <input type="number" step="0.1" class="form-control" id="user_id" required oninput="calculateBMI()">
                    </div>
                    <div class="mb-3">
                        <label for="weight" class="form-label">‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
                        <input type="number" step="0.1" class="form-control" id="weight" required oninput="calculateBMI()">
                    </div>
                    <div class="mb-3">
                        <label for="height" class="form-label">üìè ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
                        <input type="number" step="0.1" class="form-control" id="height" required oninput="calculateBMI()">
                    </div>
                    <div class="mb-3">
                        <label for="bmi" class="form-label">üìä ‡∏Ñ‡πà‡∏≤ BMI</label>
                        <input type="number" step="0.1" class="form-control" id="bmi" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="date" class="form-label">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                        <input type="date" class="form-control" id="date" required>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-success">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
        <div class="card mt-4">
            <div class="card-header text-center">
                <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏ûüíñ</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <button type="button" class="btn btn-primary" onclick="loadHealthHistory()">‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
                                <th>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</th>
                                <th>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</th>
                                <th>BMI</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="health-history-table">
                            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ -->
        <div class="card mt-4">
            <div class="card-header text-center">
                <h3>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h3>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <canvas id="bmiChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Chart.js ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å API)
        let healthHistoryData = [];
        let bmiChart;

        function login(event) {
            event.preventDefault();
            const user_name = document.getElementById('user_name').value;
            const password = document.getElementById('password').value;

            fetch('https://backend-mini-six.vercel.app/login', { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ user_name, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message !== 'Invalid credentials') {
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('app-section').style.display = 'block';
                    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                    loadHealthHistory();
                } else {
                    alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            });
        }

        function logout() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('app-section').style.display = 'none';
        }

        function saveHealthData(event) {
            event.preventDefault();
            const user_id = document.getElementById('user_id').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('height').value;
            const bmi = document.getElementById('bmi').value;
            const date = document.getElementById('date').value;

            fetch('https://backend-mini-six.vercel.app/healthdata', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ user_id, weight, height, bmi, date })
            })
            .then(response => response.json())
            .then(data => {
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà
                loadHealthHistory();
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
                document.getElementById('weight').value = '';
                document.getElementById('height').value = '';
                document.getElementById('bmi').value = '';
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            });
        }

        function calculateBMI() {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);

            if (weight > 0 && height > 0) {
                const heightInMeters = height / 100;
                const bmi = (weight / (heightInMeters ** 2)).toFixed(1); 
                document.getElementById('bmi').value = bmi;
            } else {
                document.getElementById('bmi').value = '';
            }
        }

        function loadHealthHistory() {
            const user_id = document.getElementById('user_id').value;
            
            // ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API
            fetch(`https://backend-mini-six.vercel.app/healthdata/${user_id}`)
            .then(response => response.json())
            .then(data => {
                healthHistoryData = data;
                displayHealthHistory();
                updateBmiChart();
            })
            .catch(error => {
                console.error('Error:', error);
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
                healthHistoryData = [
                    { date: '2025-01-10', weight: 80.5, height: 170, bmi: 27.9 },
                    { date: '2025-01-20', weight: 79.2, height: 170, bmi: 27.4 },
                    { date: '2025-02-01', weight: 78.0, height: 170, bmi: 27.0 },
                    { date: '2025-02-15', weight: 76.5, height: 170, bmi: 26.5 }
                ];
                displayHealthHistory();
                updateBmiChart();
            });
        }

        function displayHealthHistory() {
            const tableBody = document.getElementById('health-history-table');
            tableBody.innerHTML = '';

            healthHistoryData.sort((a, b) => new Date(b.date) - new Date(a.date));

            healthHistoryData.forEach(item => {
                const row = document.createElement('tr');
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô dd/mm/yyyy
                const dateParts = item.date.split('-');
                const formattedDate = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ BMI
                let status = '';
                let statusClass = '';
                
                if (item.bmi < 18.5) {
                    status = '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ô‡πâ‡∏≠‡∏¢';
                    statusClass = 'text-warning';
                } else if (item.bmi >= 18.5 && item.bmi < 25) {
                    status = '‡∏õ‡∏Å‡∏ï‡∏¥';
                    statusClass = 'text-success';
                } else if (item.bmi >= 25 && item.bmi < 30) {
                    status = '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô';
                    statusClass = 'text-warning';
                } else {
                    status = '‡∏≠‡πâ‡∏ß‡∏ô';
                    statusClass = 'text-danger';
                }

                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${item.weight}</td>
                    <td>${item.height}</td>
                    <td>${item.bmi}</td>
                    <td class="${statusClass}">${status}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function updateBmiChart() {
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            const sortedData = [...healthHistoryData].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const labels = sortedData.map(item => {
                const date = new Date(item.date);
                return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
            });
            
            const weightData = sortedData.map(item => item.weight);
            const bmiData = sortedData.map(item => item.bmi);

            const ctx = document.getElementById('bmiChart').getContext('2d');
            
            // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if (bmiChart) {
                bmiChart.destroy();
            }
            
            bmiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)',
                            data: weightData,
                            borderColor: 'rgb(75, 192, 192)',
                            tension: 0.1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'BMI',
                            data: bmiData,
                            borderColor: 'rgb(255, 99, 132)',
                            tension: 0.1,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'BMI'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>

</html>